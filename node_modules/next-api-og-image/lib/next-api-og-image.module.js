import{renderToStaticMarkup as e}from"react-dom/server";import r from"deepmerge";import t from"twemoji";import n from"puppeteer-core";import o from"chrome-aws-lambda";function s(){return s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s.apply(this,arguments)}var a=["body","query"];function i(i){var m=(i=r({contentType:i.type?"image/"+i.type:"image/png",strategy:"query",cacheControl:"max-age 3600, must-revalidate",width:1200,height:630,type:"png",quality:90,dev:{inspectHtml:!0,errorsInResponse:!0}},i)).template,l=m.html,p=m.react,h=i.cacheControl,v=i.strategy,y=i.contentType,f=i.width,d=i.height,g=i.type,P=i.quality,w=i.dev,b=w.inspectHtml,q=w.errorsInResponse;if(l&&p)throw new Error("Ambigious template provided. You must provide either `html` or `react` template.");if(!l&&!p)throw new Error("No template was provided.");var j,C=process.env.NODE_ENV,x=function(){var e=[].slice.call(arguments);return function(){try{return Promise.resolve(e.reduce(function(e,r){try{return Promise.resolve(e).then(function(e){return Promise.resolve(r(e))})}catch(e){return Promise.reject(e)}},Promise.resolve({envMode:process.env.NODE_ENV})))}catch(e){return Promise.reject(e)}}}(u,(j={width:f,height:d},function(e){try{var r=function(r){return Promise.resolve(n.launch(u?r:{args:m,executablePath:r,headless:o.headless})).then(function(r){return Promise.resolve(r.newPage()).then(function(r){return Promise.resolve(r.setViewport(j)).then(function(){return s({},e,{page:r})})})})},t=e.page,a=e.envMode,i=e.executable;if(t)return Promise.resolve(s({},e,{page:t}));var u=!c(a),m=u||o.args;return Promise.resolve(u?r({args:[],executablePath:i,headless:!0}):Promise.resolve(o.executablePath).then(r))}catch(e){return Promise.reject(e)}}),function(e){var r=e.inspectHtml,t=e.type,n=e.quality;return function(e){var o=e.page,a=e.envMode;return s({},e,{createImage:function(e){try{return Promise.resolve(o.setContent(e)).then(function(){return Promise.resolve(!c(a)&&r?o.content():o.screenshot({type:t,encoding:"binary",quality:n}))})}catch(e){return Promise.reject(e)}}})}}({inspectHtml:b,type:g,quality:P}));return function(r,n){try{!function(e,r,t,n){var o={body:function(){var e=t.method,o=t.headers["content-type"];if("POST"!==e&&"application/json"!==o){var s="Strategy is set to `body` so parameters must be passed by POST request and JSON payload. Current method: "+e+" and current content type: "+o;throw r&&n.json({message:s}),new Error(s)}},query:function(){var e=t.method;if("GET"!==e){var o="Strategy is set to `query` so parameters must be passed by GET request and query params. Current method: "+e;throw r&&n.json({message:o}),new Error(o)}}},s=o[e];if(!s)throw new Error("Unknown strategy provided. Possible values: "+a);s()}(v,!c(C)&&q,r,n);var o=JSON.parse(JSON.stringify("query"===v?r.query:r.body,function(e,r){return r&&"object"==typeof r?r:""+r}));return Promise.resolve(x()).then(function(r){function a(a){function i(o){var s=l&&!p?o:e(o);n.setHeader("Content-Type",!c(C)&&b?"text/html":y),n.setHeader("Cache-Control",h);var a=n.write;return Promise.resolve(r.createImage(function(e){return"<style>\n    .emoji {\n      height: 1em;\n      width: 1em;\n      margin: 0 .05em 0 .1em;\n      vertical-align: -0.1em;\n    }\n  </style>"+t.parse(e,{folder:"svg",ext:".svg"})}(s))).then(function(e){a.call(n,e),n.end()})}return l&&!p?i(l&&!p?a:p(s({},o))):Promise.resolve(l&&!p?a:p(s({},o))).then(i)}return l&&!p?Promise.resolve(l&&!p?l(s({},o)):0).then(a):a(l&&!p?l(s({},o)):0)})}catch(e){return Promise.reject(e)}}}function c(e){return"production"===e||"staging"===e}function u(e){return s({},e,{executable:"win32"===process.platform?"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe":"linux"===process.platform?"/usr/bin/google-chrome":"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"})}export{i as withOGImage};
//# sourceMappingURL=next-api-og-image.module.js.map
