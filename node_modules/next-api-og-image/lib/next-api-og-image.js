var e=require("react-dom/server"),r=require("deepmerge"),t=require("twemoji"),n=require("puppeteer-core"),o=require("chrome-aws-lambda");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=a(r),i=a(t),u=a(n),c=a(o);function l(){return l=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},l.apply(this,arguments)}var m=["body","query"];function p(e){return"production"===e||"staging"===e}function h(e){return l({},e,{executable:"win32"===process.platform?"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe":"linux"===process.platform?"/usr/bin/google-chrome":"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"})}exports.withOGImage=function(r){var t=(r=s.default({contentType:r.type?"image/"+r.type:"image/png",strategy:"query",cacheControl:"max-age 3600, must-revalidate",width:1200,height:630,type:"png",quality:90,dev:{inspectHtml:!0,errorsInResponse:!0}},r)).template,n=t.html,o=t.react,a=r.cacheControl,d=r.strategy,v=r.contentType,f=r.width,y=r.height,g=r.type,P=r.quality,w=r.dev,b=w.inspectHtml,q=w.errorsInResponse;if(n&&o)throw new Error("Ambigious template provided. You must provide either `html` or `react` template.");if(!n&&!o)throw new Error("No template was provided.");var j,C=process.env.NODE_ENV,x=function(){var e=[].slice.call(arguments);return function(){try{return Promise.resolve(e.reduce(function(e,r){try{return Promise.resolve(e).then(function(e){return Promise.resolve(r(e))})}catch(e){return Promise.reject(e)}},Promise.resolve({envMode:process.env.NODE_ENV})))}catch(e){return Promise.reject(e)}}}(h,(j={width:f,height:y},function(e){try{var r=function(r){return Promise.resolve(u.default.launch(a?r:{args:s,executablePath:r,headless:c.default.headless})).then(function(r){return Promise.resolve(r.newPage()).then(function(r){return Promise.resolve(r.setViewport(j)).then(function(){return l({},e,{page:r})})})})},t=e.page,n=e.envMode,o=e.executable;if(t)return Promise.resolve(l({},e,{page:t}));var a=!p(n),s=a||c.default.args;return Promise.resolve(a?r({args:[],executablePath:o,headless:!0}):Promise.resolve(c.default.executablePath).then(r))}catch(e){return Promise.reject(e)}}),function(e){var r=e.inspectHtml,t=e.type,n=e.quality;return function(e){var o=e.page,a=e.envMode;return l({},e,{createImage:function(e){try{return Promise.resolve(o.setContent(e)).then(function(){return Promise.resolve(!p(a)&&r?o.content():o.screenshot({type:t,encoding:"binary",quality:n}))})}catch(e){return Promise.reject(e)}}})}}({inspectHtml:b,type:g,quality:P}));return function(r,t){try{!function(e,r,t,n){var o={body:function(){var e=t.method,o=t.headers["content-type"];if("POST"!==e&&"application/json"!==o){var a="Strategy is set to `body` so parameters must be passed by POST request and JSON payload. Current method: "+e+" and current content type: "+o;throw r&&n.json({message:a}),new Error(a)}},query:function(){var e=t.method;if("GET"!==e){var o="Strategy is set to `query` so parameters must be passed by GET request and query params. Current method: "+e;throw r&&n.json({message:o}),new Error(o)}}},a=o[e];if(!a)throw new Error("Unknown strategy provided. Possible values: "+m);a()}(d,!p(C)&&q,r,t);var s=JSON.parse(JSON.stringify("query"===d?r.query:r.body,function(e,r){return r&&"object"==typeof r?r:""+r}));return Promise.resolve(x()).then(function(r){function u(u){function c(s){var u=n&&!o?s:e.renderToStaticMarkup(s);t.setHeader("Content-Type",!p(C)&&b?"text/html":v),t.setHeader("Cache-Control",a);var c=t.write;return Promise.resolve(r.createImage(function(e){return"<style>\n    .emoji {\n      height: 1em;\n      width: 1em;\n      margin: 0 .05em 0 .1em;\n      vertical-align: -0.1em;\n    }\n  </style>"+i.default.parse(e,{folder:"svg",ext:".svg"})}(u))).then(function(e){c.call(t,e),t.end()})}return n&&!o?c(n&&!o?u:o(l({},s))):Promise.resolve(n&&!o?u:o(l({},s))).then(c)}return n&&!o?Promise.resolve(n&&!o?n(l({},s)):0).then(u):u(n&&!o?n(l({},s)):0)})}catch(e){return Promise.reject(e)}}};
//# sourceMappingURL=next-api-og-image.js.map
